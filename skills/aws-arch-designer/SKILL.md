---
name: aws-arch-designer
description: AWS 架构设计说明书生成器。将零散的客户材料（会议记录、需求列表、代码片段等）转化为结构化、符合 AWS Best Practice 的《架构设计说明书》。支持 Web 应用、AI/ML（GenAI、RAG、Agentic）、大数据（批处理、实时流、数据湖）等多种架构类型。
---

# AWS 架构设计说明书生成器

将零散的客户材料自动转化为结构化、可审计、符合 AWS Best Practice 的《架构设计说明书》。

## 核心能力

- **多模态材料解析**: 直接处理 Word、Excel、PDF、Markdown、图片等任意格式材料
- **批量上传支持**: 支持用户将材料集中在一个目录，批量上传
- **智能追问**: 自动识别缺失信息并主动追问（P0 关键信息）
- **架构决策**: 基于 AWS Well-Architected Framework 进行服务选型
- **多场景支持**: Web 应用、AI/ML、大数据、SaaS、混合云
- **自动模板选择**: 根据项目类型自动选择专用模板（Agentic AI 14 章 / 通用 11 章）
- **标准化输出**: 生成完整的架构设计说明书（Markdown 文件）

---

## 📊 工作流程总览

```
用户材料输入（多模态）
    ↓
[步骤 0] 案例学习识别 (自动触发)
    ↓
[步骤 1] Material Parser
    → 提取需求 + 识别项目类型 + 检测架构图
    ↓
[🔍 决策点检查]
    → P0 问题 ✓ | 项目类型 ✓ | 约束条件 ✓
    ↓
[步骤 2] Architecture Decisioning
    → 服务选型 + WAF 检查 + 架构模式选择
    ↓
[步骤 3] Architecture Diagram Processing
    ├─ 用户已提供 → 验证 + 描述
    └─ 用户未提供 → 构建蓝图 + MCP 生成
    ↓
[步骤 4] Design Writer
    ├─ AI Agentic → 14 章模板
    └─ 其他类型 → 11 章通用模板
    ↓
[步骤 5] Design Reviewer
    → 完整性 + WAF 检查 + 一致性验证
    ↓
最终文档输出 (.md)
```

---

## 工作流程详解（6 步）

### 步骤 0: 案例学习文件识别与分析

**触发条件**: 自动检测，无需用户指定

**支持格式**: Word、PDF、图片、Excel、Markdown 等任意格式

**执行任务**:
1. **自动检测案例文件** - LLM 理解文件内容，识别是否为案例
2. **结构化信息提取** - 提取背景、痛点、方案、指标、收益、经验
3. **相关性匹配** - 计算与新项目的相似度（0-100 分）
4. **提取可复用资源** - 验证过的服务组合、成本基线、经验教训

**输出**: 案例分析结果 + 相关性评分和建议

**优势**: 加速设计 50%、基于验证的最佳实践、规避已知风险

---

### 步骤 1: Material Parser（需求提取）

**目标**: 从任意格式材料中提取结构化需求信息

**支持的输入**:
- **文本类**: 会议记录、需求列表、代码片段、Markdown
- **文档类**: Word (docx)、Excel (xlsx)、PDF
- **图片类**: PNG、JPEG、JPG、GIF、WebP、SVG、BMP
- **混合形式**: 多个不同格式文件批量上传

**执行任务**:

1. **多模态理解** - LLM 直接处理所有格式，无需脚本预处理
2. **检测案例文件** - 若存在，自动触发步骤 0
3. **提取 5 大关键要素**:
   - **功能需求** - 系统需要实现的业务功能
   - **非功能需求** - 可用性、性能、延迟、扩展性、RTO/RPO
   - **合规性要求** - 等保、GDPR、数据本地化
   - **预算限制** - 月度/年度预算上限
   - **预估流量** - DAU、QPS、数据量、峰值倍数
4. **识别项目类型** - Web / AI-GenAI / AI-RAG / AI-Agentic / BigData / SaaS / Migration
5. **检测用户架构图** - 判断用户是否提供了架构图（PNG/PDF/JPEG）
6. **标注缺失信息** - 标记 P0 关键信息的缺失
7. **生成追问列表** - 基于缺失的 P0 信息生成 3-5 个问题
8. **输出结构化 JSON**

**关键原则**:
- ✅ 多模态直接理解，无需脚本预处理
- ✅ 不脑补未明确的强约束
- ✅ 信息不足时标注假设并主动追问

---

### 🔍 决策点检查（步骤 1 → 步骤 2 之间）

**必须确认以下条件，否则不得进入步骤 2**:

| 检查项 | 要求 | 未通过的处理 |
|-------|------|------------|
| **P0 问题已回答** | RTO/RPO、可用性、峰值流量、合规要求 | 继续追问，直到回答 |
| **项目类型已识别** | 明确项目类型（Web/AI/BigData） | 基于材料推断，标注假设 |
| **用户架构图状态** | 已确定（有/无） | 明确检测结果 |
| **约束条件已清晰** | Region、合规、预算 | 标注为"未确认" |

🚫 **如果以上任意一项未确认，不得进入步骤 2**

---

### 步骤 2: Architecture Decisioning（架构决策）

**目标**: 基于结构化需求进行服务选型和 WAF 评估

**前置条件**: 步骤 1 已完成，决策点检查通过

**执行任务**:

1. **选择架构模式**
   - 从 `references/architecture_patterns.md` 中选择匹配的模式
   - 传统应用: Web 三层、Serverless API、SaaS 多租户、混合云
   - AI/ML: GenAI、RAG、Agentic、MLOps、多模态
   - 大数据: 批处理、实时流、数据湖、计算集群

2. **服务选型决策**
   - 对每个需求维度（计算/存储/数据库/网络）进行完整分析
   - 必须包含: Why / Pros / Cons / Alternatives
   - 示例: RDS vs Aurora（性能/成本/适用场景对比）

3. **AWS Well-Architected Framework 强制检查**
   - ✅ 卓越运营 (Operational Excellence) - IaC、日志、监控、自动化
   - ✅ 安全性 (Security) - IAM、加密、网络隔离、审计
   - ✅ 可靠性 (Reliability) - Multi-AZ、故障转移、RTO/RPO
   - ✅ 性能效率 (Performance Efficiency) - 实例选型、缓存、CDN
   - ✅ 成本优化 (Cost Optimization) - Auto Scaling、RI、生命周期
   - ✅ 可持续性 (Sustainability) - Graviton、资源利用率

4. **项目特定检查**
   - **AI/ML 项目**: Token 成本、推理延迟、幻觉防护、数据漂移、MLOps
   - **大数据项目**: 数据分区、存储优化、查询性能、数据质量、治理
   - **AI/ML-Agentic 项目特别检查**: 参考 `references/agentic_ai_practice_requirements.md`
     - 六大核心能力: 推理、SDKs/工具、互操作性、安全、负责任 AI、计算
     - 确保设计覆盖所有核心能力要求

5. **Region/China 特判**
   - 检查是否使用了 China Region 不可用服务
   - 检查数据合规性（GDPR/数据本地化）

**输出**: 完整的架构决策 + WAF 评估结果（JSON 格式）

**关键原则**:
- ✅ 每个服务选择必须通过 WAF 检查
- ✅ 必须提供决策理由和替代方案
- 🚫 禁止跳过 WAF 评估
- 🚫 禁止过度设计（无需求不上 EKS/Multi-Region）

---

### 步骤 3: Architecture Diagram Processing（架构图处理）

**目标**: 正确处理架构图，尊重用户已有设计

**🚫 CRITICAL 禁止事项**:
- **如果用户提供了架构图，绝对不要自行设计和生成新的**
- **只能理解、验证和描述用户提供的架构图**
- **只有在用户明确未提供架构图时，才能调用 MCP Server 生成新的**

---

#### 情况 1: 用户提供了架构图（PNG/PDF/JPEG）

**执行任务**:
1. **识别服务** - 识别架构图中的 AWS 服务图标和组件
2. **理解连接** - 理解数据流和服务间的连接关系
3. **生成文字描述** - 生成架构图的文字描述（用于 Design Writer）
4. **一致性验证** - 验证架构图与需求的匹配度（仅验证，不修改）
5. **输出分析结果** - 记录识别的服务、连接关系、验证结果

**✅ 应该说的话**:
```
"您的架构图显示了一个 Web 三层架构，包含 ALB、EC2 Auto Scaling Group 和 RDS Multi-AZ..."
"基于您提供的架构，这些服务组合可以满足 99.9% 可用性要求..."
"一个可选的改进建议是添加 ElastiCache 缓存层（如果您希望进一步优化性能）"
```

**🚫 严格禁止**:
```
"我会为您设计一个更好的架构..." ❌
"让我重新生成一个架构图..." ❌
"您的架构图不够优化，我会调整..." ❌
```

---

#### 情况 2: 用户未提供架构图

**执行任务**:
1. **构建架构蓝图** - 基于步骤 2 的架构决策构建蓝图（服务列表 + 连接关系）
2. **调用 MCP Server** - 使用 `awslabs-aws-diagram-mcp-server` 生成架构图
3. **生成文字描述** - 生成架构图的文字描述
4. **一致性验证** - 验证生成的架构图与需求的匹配度

**MCP Server 调用示例**:
```json
{
  "services": [
    {"name": "ALB", "type": "Application Load Balancer"},
    {"name": "EC2-ASG", "type": "EC2 Auto Scaling Group"},
    {"name": "RDS-MySQL", "type": "RDS for MySQL Multi-AZ"}
  ],
  "connections": [
    {"from": "ALB", "to": "EC2-ASG", "label": "HTTP/HTTPS"},
    {"from": "EC2-ASG", "to": "RDS-MySQL", "label": "SQL Query"}
  ]
}
```

---

**输出**: 架构图文件（PNG/SVG）+ 文字描述 + 验证结果

---

### 步骤 4: Design Writer（文档生成）

**目标**: 按项目类型对应的模板生成架构设计说明书

**前置条件**: 步骤 2 和 3 已完成，架构决策和架构图已确定

**📋 模板选择规则（自动）**:

| 项目类型判定 | 使用模板 | 章节数 | 特殊设计 |
|------------|---------|--------|---------|
| `project_type == "AI/ML-Agentic"` | `design_doc_template_ai_agentic.md` | **14** | Agent 编排、LLM 部署、幻觉检测、负责任 AI、HITL |
| 其他所有类型 | `design_doc_template.md` | **11** | 标准 AWS Well-Architected 设计 |

**自动触发时机**: 步骤 4 开始时

---

**CRITICAL - 必须执行**:
- ✅ 根据项目类型自动选择对应的模板
- ✅ 填充所有 P0 占位符（必填项不可留空）
- ✅ **生成完整的 Markdown 文件**（不仅仅是文本响应）
- ✅ 文件命名规则: `{PROJECT_NAME}_架构设计说明书_v1.0.md`
- ✅ **遵循文档写作标准与语言规范**（见下文）

**执行任务**:
1. **选择模板** - AI Agentic 用 14 章专用模板，其他用 11 章通用模板
2. **填充占位符** - 所有 `{PLACEHOLDER}` 必须替换为实际内容
3. **遵循章节结构** - 不可改变章节顺序或合并章节
4. **记录决策理由** - 每个技术选择必须包含 Why 和 Trade-off
5. **标注假设** - 所有假设使用 `【假设】` 标签明确标注
6. **应用写作标准** - 确保语言专业、丰满、精准（见下文规范）
7. **输出 Markdown 文件** - 保存到工作目录

---

#### 📝 文档写作标准与语言规范

**核心原则**: 语言专业、表达丰满、逻辑严谨、不啰嗦冗余

---

##### 1️⃣ 语言专业性要求

**✅ 推荐写法**（专业、丰满）:
```markdown
本架构采用 Amazon RDS for MySQL Multi-AZ 部署方案，主要基于以下考量：

在数据库层面，我们选择了 RDS Multi-AZ 而非单实例部署，这一决策确保了系统在可用性和数据持久性方面达到生产级标准。Multi-AZ 配置通过在不同可用区维护同步副本，实现了自动故障转移能力，RTO 可控制在 1-2 分钟内，RPO 接近零，满足业务对 99.9% 可用性的明确要求。

从运维角度看，RDS 托管服务显著降低了运维复杂度。自动化补丁管理、备份策略和性能监控等特性，使团队能够将精力聚焦于业务优化而非基础设施维护。相较于自建 MySQL 集群，RDS 在初期可节省约 60% 的运维投入。

**权衡分析**：
- **优势**: Multi-AZ 提供了自动故障转移能力，无需人工干预；托管服务降低运维负担；成本可预测
- **劣势**: 相比 Aurora，性能上限较低（约为 Aurora 的 1/5）；存储扩展上限为 64 TiB
- **替代方案**: 若未来流量增长超过 10 倍或需要全球化部署，建议评估迁移至 Aurora Global Database

**成本考量**: 基于预估流量（10 万 DAU），db.r5.large Multi-AZ 实例月成本约 $450，相较于 Aurora 节省约 25%。
```

**❌ 避免写法**（过于简单）:
```markdown
使用 RDS Multi-AZ。

优点：
- 高可用
- 自动备份
- 易于管理

缺点：
- 性能不如 Aurora
```

---

##### 2️⃣ 技术决策表达规范

**每个技术选择必须包含 4 个要素**:

| 要素 | 说明 | 示例 |
|-----|------|------|
| **决策内容** | 选择了什么服务/方案 | "采用 Application Load Balancer (ALB) 作为流量入口" |
| **决策理由 (Why)** | 为什么这样选择 | "ALB 提供 7 层路由能力，支持基于路径和主机名的规则，满足多服务路由需求" |
| **权衡分析 (Trade-off)** | 优势、劣势、替代方案 | "相比 NLB，ALB 牺牲了部分性能（约 10%），但换取了更灵活的路由能力" |
| **量化指标** | 成本、性能、规模等数据 | "预计月成本 $50，可处理 500 QPS，满足当前 2 倍冗余" |

**完整示例**:
```markdown
### 5.2 负载均衡层设计

**技术选择**: Application Load Balancer (ALB)

**决策理由**:
本架构选择 ALB 作为流量入口，主要基于以下技术考量：首先，ALB 提供的 7 层路由能力与当前业务需求高度契合，系统需要根据 URL 路径将请求分发至不同的后端服务（/api/* 路由至 API 服务，/static/* 路由至静态资源服务），这是 4 层负载均衡器（如 NLB）无法提供的；其次，ALB 原生集成了 WAF 和 AWS Shield，可直接应用安全防护策略，无需额外架设反向代理层。

从运维成熟度角度，ALB 提供了丰富的监控指标（请求数、延迟分布、健康检查状态等），这些数据可直接导入 CloudWatch 进行告警配置，运维团队已具备相关经验。

**权衡分析**:
- **性能考量**: ALB 的吞吐量理论上限约为 NLB 的 85-90%，在当前流量规模（峰值 500 QPS）下，性能差异可忽略不计。若未来流量增长至 5000+ QPS，需重新评估
- **成本对比**: ALB 按小时和 LCU（负载均衡器容量单位）计费，预估月成本约 $50-80，相比 NLB 高约 15%，但换取了路径路由和 WAF 集成能力
- **替代方案**: 若后续系统演化为纯 TCP/UDP 流量或对延迟极度敏感（< 5ms），可考虑迁移至 NLB；若需要全球化流量分发，可在 ALB 前端增加 CloudFront

**技术规格**:
- 部署模式: 跨 2 个可用区（AZ-A 和 AZ-B）
- 健康检查: HTTP /health 端点，间隔 30s，失败阈值 3 次
- 连接超时: 60s（考虑到部分 API 调用耗时较长）
- 预估性能: 可处理 1000 QPS（当前峰值的 2 倍冗余）
```

---

##### 3️⃣ 避免过度啰嗦

**❌ 啰嗦写法**:
```markdown
在本项目的架构设计中，我们经过了非常详细和深入的分析与讨论，最终决定采用 Amazon RDS 作为我们的数据库解决方案。这个决定是在团队内部经过了多轮的技术评审会议，综合考虑了各种各样的因素，包括但不限于性能、成本、可维护性、扩展性等等多个维度之后做出的。我们认为 RDS 是一个非常好的选择，因为它提供了很多很多的优势，比如说它是托管服务，这意味着我们不需要自己去管理底层的基础设施...（继续重复）
```

**✅ 精简专业写法**:
```markdown
本架构选择 Amazon RDS for MySQL 作为数据库层，这一决策综合考虑了性能、成本和运维三个维度。RDS 托管服务消除了底层基础设施管理负担，使团队能专注于数据库优化和业务逻辑。Multi-AZ 部署确保了 99.9% 的可用性目标，自动故障转移机制将 RTO 控制在 2 分钟以内。成本方面，db.r5.large 实例月费用约 $450，相较于自建方案节省约 60% 的运维成本。
```

**关键原则**:
- ✅ 每句话都应承载实质信息
- ✅ 避免"非常"、"很多"等模糊词汇
- ✅ 用数据和事实说话
- ❌ 删除冗余的铺垫和重复

---

##### 4️⃣ 假设的标注规范

**格式**: `【假设】说明内容`

**示例**:
```markdown
### 6.3 数据库容量规划

基于业务增长预测，我们制定了未来 12 个月的容量规划：

**当前基线**:
- 数据量: 200 GB
- 日增长: 500 MB
- 【假设】用户增长率保持在 15%/季度，与过去 6 个月趋势一致

**容量预测**:
- 6 个月后: 约 300 GB（50% 增长）
- 12 个月后: 约 450 GB（125% 增长）

**扩容触发点**: 当存储使用率达到 70%（即约 350 GB）时，触发自动扩容至 500 GB。【假设】RDS 的自动扩容不会影响业务（根据 AWS 文档，扩容过程对性能影响 < 5%）。
```

---

##### 5️⃣ 分层次的信息呈现

**推荐结构**:
```markdown
### [章节标题] - 概括性标题

**核心决策**: 一句话总结

**背景与动机**:
[2-3 段] 为什么需要这个设计，解决什么问题

**技术方案**:
[详细设计] 具体如何实现，包含配置参数

**权衡分析**:
- 优势: ...
- 劣势: ...
- 替代方案: ...

**量化指标**:
- 性能: ...
- 成本: ...
- 规模: ...
```

**反例**（平铺直叙）:
```markdown
### 数据库设计

使用 RDS。选择 MySQL。开启 Multi-AZ。配置备份。设置监控。
```

---

##### 6️⃣ 专业术语使用规范

**✅ 准确使用 AWS 术语**:
```markdown
正确: "Application Load Balancer (ALB)"
错误: "应用负载均衡器" 或 "ALB 负载均衡"

正确: "Amazon EC2 Auto Scaling Group"
错误: "EC2 自动扩展组" 或 "ASG"

正确: "Multi-AZ 部署"
错误: "多可用区部署" 或 "跨 AZ"
```

**✅ 技术指标的表达**:
```markdown
正确: "RTO < 1h, RPO < 15min"
错误: "恢复时间很快" 或 "数据不会丢失"

正确: "P99 延迟 < 200ms"
错误: "延迟很低" 或 "响应速度快"

正确: "峰值 QPS 500，平均 QPS 150"
错误: "并发量很高" 或 "流量很大"
```

---

##### 7️⃣ 完整示例对比

**❌ 不合格示例**（过于简单）:
```markdown
## 5. 计算层设计

使用 EC2。

优点：灵活、可控。
缺点：需要运维。
```

**✅ 合格示例**（专业丰满）:
```markdown
## 5. 计算层设计

### 5.1 核心决策

本架构采用 **Amazon EC2 Auto Scaling Group** 作为应用计算层，配合 **Application Load Balancer** 实现高可用和弹性伸缩。

### 5.2 决策理由

**技术匹配度**：
当前应用基于 Spring Boot 框架，部署为传统 JAR 包，EC2 提供的虚拟机环境与现有部署流程无缝对接，迁移成本最低。相较于容器化方案（ECS/EKS），EC2 方案避免了应用改造和团队学习曲线，预计可缩短上线周期 2-3 个月。

**运维平衡**：
虽然 EC2 需要管理操作系统层（补丁、安全加固等），但团队已具备相关运维经验，且 AWS Systems Manager 提供的自动化补丁管理功能可覆盖 80% 的日常运维工作。这一权衡在当前阶段是合理的——待系统稳定运行 6-12 个月后，可评估容器化改造的 ROI。

### 5.3 技术规格

**实例配置**：
- 实例类型: **t3.medium** (2 vCPU, 4 GiB RAM)
- 选型依据: 基于压测数据，单实例可稳定处理 50 QPS，内存占用峰值约 2.5 GB，t3.medium 提供了约 60% 的性能冗余
- 【假设】应用优化后，单实例处理能力可提升至 80 QPS

**Auto Scaling 策略**：
- 最小实例数: 2（跨 2 个 AZ，确保单 AZ 故障时仍可服务）
- 最大实例数: 10（满足峰值流量 500 QPS 的需求，含 2 倍安全冗余）
- 扩容条件: CPU 使用率 > 70% 持续 5 分钟
- 缩容条件: CPU 使用率 < 30% 持续 15 分钟
- 冷却期: 扩容 300s，缩容 600s（避免频繁抖动）

**生命周期管理**：
- AMI 更新策略: 每季度更新基础镜像（包含安全补丁）
- 滚动更新: 使用蓝绿部署，确保零停机
- 健康检查: ALB 每 30s 检查 /health 端点

### 5.4 权衡分析

**与 ECS Fargate 对比**：
| 维度 | EC2 ASG | ECS Fargate | 决策 |
|------|---------|-------------|------|
| 迁移成本 | 低（无需改造） | 高（需容器化） | ✅ EC2 优势 |
| 运维负担 | 中（需管理 OS） | 低（无需管理 OS） | ⚠️ Fargate 优势 |
| 成本 | $200/月 | $280/月（同等配置） | ✅ EC2 优势 |
| 启动速度 | 60-90s | 30-45s | ⚠️ Fargate 优势 |

**综合评估**: 在当前阶段（MVP 上线后 6 个月内），EC2 方案在迁移成本和总成本方面优势明显。建议在系统稳定运行 6-12 个月后，基于实际运维数据重新评估容器化收益。

### 5.5 成本估算

**月度成本明细**（基于 us-east-1 区域定价）：
- t3.medium 按需实例: $30.37/实例/月
- 平均运行实例数: 3-4 个（基于流量波动）
- Auto Scaling（服务费用）: 免费
- **预估月成本**: $90-120

**优化建议**: 待系统稳定运行 3 个月后，可评估购买 1-2 个 Savings Plans（可节省约 30% 成本）。
```

---

**📌 总结：文档写作的 5 个黄金标准**

| 标准 | 说明 | 检查方法 |
|-----|------|---------|
| **1. 专业性** | 使用准确的 AWS 术语和技术指标 | 每个服务名称、指标都符合 AWS 官方表述 |
| **2. 丰满性** | 每个决策都有充分的理由和分析 | 每章节 ≥ 200 字，包含背景、方案、权衡 |
| **3. 量化性** | 用数据和指标说话，不用模糊词汇 | 成本/性能/规模都有具体数字 |
| **4. 逻辑性** | 决策链条清晰（需求→方案→权衡→结论） | 每个决策都能追溯到具体需求 |
| **5. 精简性** | 不啰嗦，不重复，每句话都有价值 | 删除"非常"、"很多"等空洞词汇 |

---

**详细指南**:
- [DESIGN_WRITER_GUIDE.md](./DESIGN_WRITER_GUIDE.md) - 步骤 4 完整实施指南
- [references/WRITING_STANDARDS.md](./references/WRITING_STANDARDS.md) - 写作标准参考手册（必读）

**文件命名示例**:
```
电商平台云迁移_架构设计说明书_v1.0.md
智能客服代理系统_Agentic_架构设计说明书_v1.0.md
```

---

### 步骤 5: Design Reviewer（设计审查）

**目标**: 检查架构设计的完整性和正确性

**前置条件**: 步骤 4 已完成，设计文档已生成

**执行任务**:

#### 1. 区域合规性检查
- [ ] China Region 是否使用了不可用服务？
- [ ] 是否考虑数据合规性（GDPR/数据本地化）？
- [ ] 服务配额是否满足需求？

#### 2. 架构一致性检查
- [ ] 是否存在矛盾设计？（如：无 NAT Gateway 却声称可访问公网）
- [ ] 是否存在过度设计？（如：小流量场景使用 EKS）
- [ ] 服务选择是否与需求和约束相符？
- [ ] 架构图与文档描述是否一致？

#### 3. 必备组件检查
- [ ] IAM 角色设计完整
- [ ] CloudWatch Logs 日志方案清晰
- [ ] Backup 备份策略明确
- [ ] RTO/RPO 已定义
- [ ] 成本估算已提供
- [ ] 监控和告警已规划

#### 4. AWS Best Practice 检查
- [ ] Multi-AZ 部署（生产环境）
- [ ] 加密已启用（传输 + 静态）
- [ ] MFA 已配置（管理员账户）
- [ ] 告警已设置（CPU/内存/错误率）
- [ ] Auto Scaling 已配置

#### 5. WAF 六大支柱复审
- [ ] 卓越运营：IaC、日志、监控、自动化
- [ ] 安全性：IAM、加密、网络、审计
- [ ] 可靠性：Multi-AZ、故障转移、RTO/RPO
- [ ] 性能效率：实例选型、缓存、CDN
- [ ] 成本优化：Auto Scaling、RI、生命周期
- [ ] 可持续性：Graviton、资源利用率

#### 6. AI/ML-Agentic 项目特殊检查（仅 Agentic 项目）
- [ ] **六大核心能力覆盖检查** - 参考 `references/agentic_ai_practice_requirements.md`
  - [ ] 推理 (Inference) - 第 5、6、9 章
  - [ ] SDKs/工具 (SDKs/Library/Tooling) - 第 6 章
  - [ ] 互操作性 (Interoperability) - 第 6.2、7.3、10.3 章
  - [ ] 安全 (Security) - 第 10、11 章
  - [ ] 负责任的 AI (Responsible AI) - 第 8、9.3、10.2、11.5 章
  - [ ] 计算 (Compute) - 第 4、5、9 章
- [ ] **客户案例要求检查**
  - [ ] 实践方法实施 - 第 1、3、5、6 章
  - [ ] 安全与互操作性实践 - 第 6.2、10、10.1、10.3 章
  - [ ] 负责任的 AI 实践 - 第 8、10.2、11.5、13 章
  - [ ] 计算实践 - 第 3、4、5、9 章

**输出**:
- ✅ **通过** - 文档完整、无关键问题
- ❌ **不通过** - 列出问题清单，返回步骤 2 或 4 修订

---

## 🚫 核心原则与禁止事项

### 5 条铁律（不可违反）

| 编号 | 原则 | 说明 |
|-----|------|------|
| **1** | **严格遵循 6 步流程** | 不可跳过或合并步骤，每步必须有输出 |
| **2** | **尊重用户的架构图** | 若用户提供了架构图，绝不自作主张重新设计 |
| **3** | **WAF 检查强制执行** | 每个服务选择必须通过 6 大支柱评估 |
| **4** | **记录所有决策理由** | 每个技术选择都要有 Why 和 Trade-off |
| **5** | **主动追问缺失信息** | P0 信息（RTO/RPO/可用性/流量）不可假设 |

---

### AI/ML 项目禁止事项

| 禁止行为 | 正确做法 |
|---------|---------|
| 🚫 忽略 Token 成本 | ✅ 分析成本、制定控制策略（缓存、限流、模型降级） |
| 🚫 忽略幻觉防护 | ✅ 设计检测和降级策略（Guardrails、人工审核） |
| 🚫 忽略人类在循环 (HITL) | ✅ 明确 HITL 流程和触发条件 |
| 🚫 Agentic 项目用通用模板 | ✅ 必须使用 14 章专用模板 |
| 🚫 忽略数据漂移监控 | ✅ 配置 SageMaker Model Monitor |

---

### 大数据项目禁止事项

| 禁止行为 | 正确做法 |
|---------|---------|
| 🚫 忽略数据分区策略 | ✅ 明确分区键（日期/地区/业务维度） |
| 🚫 忽略存储优化 | ✅ 配置生命周期策略（Standard → IA → Glacier） |
| 🚫 忽略数据质量检查 | ✅ 设计检查和治理机制（Glue Data Quality） |
| 🚫 忽略查询性能优化 | ✅ 使用列式存储（Parquet/ORC）、合理分区 |

---

### 通用禁止事项

| 禁止行为 | 后果 | 正确做法 |
|---------|------|---------|
| 🚫 跳过决策点检查 | 架构决策缺少关键信息 | 确保 P0 问题已回答 |
| 🚫 跳过 WAF 评估 | 架构不符合最佳实践 | 强制评估 6 大支柱 |
| 🚫 过度设计 | 成本浪费、复杂度高 | 选择能满足需求的最简方案 |
| 🚫 脑补未明确的约束 | 假设错误、返工 | 标注假设、主动追问 |
| 🚫 生成纯文本响应 | 无法交付、格式混乱 | 必须生成 Markdown 文件 |

---

## 使用示例

详细的使用示例请参考 [EXAMPLES.md](./EXAMPLES.md)，包括：
- **示例 1**: 电商平台迁移云（Web 应用 - 11 章通用模板）
- **示例 2**: AI 知识库问答系统（RAG - 11 章通用模板）
- **示例 3**: AI 客服代理系统（Agentic - 14 章专用模板）
- **示例 4**: 基于案例学习的快速设计

---

## 相关文档

| 文档 | 用途 | 适合人群 |
|-----|------|---------|
| [SKILL.md](./SKILL.md) | 本文档 - 完整使用指南 | 用户、架构师 |
| [DESIGN_WRITER_GUIDE.md](./DESIGN_WRITER_GUIDE.md) | 步骤 4 的详细实施指南 | LLM、文档生成器 |
| [references/WRITING_STANDARDS.md](./references/WRITING_STANDARDS.md) | 写作标准参考手册（步骤 4 必读） | LLM、文档生成器 |
| [EXAMPLES.md](./EXAMPLES.md) | 4 个完整使用示例 | 用户、学习者 |
| [BEST_PRACTICES.md](./BEST_PRACTICES.md) | 最佳实践和检查清单 | 架构师、审核者 |
| [OPTIMIZATION_GUIDE.md](./OPTIMIZATION_GUIDE.md) | 脚本优化和实施建议 | 开发者、维护人员 |
| [DEEPV.md](./DEEPV.md) | 深层设计和内部实现 | 开发者、贡献者 |
| [references/architecture_patterns.md](./references/architecture_patterns.md) | 架构模式库 | 架构师 |
| [references/waf_checklist.md](./references/waf_checklist.md) | WAF 检查清单 | 架构师、审核者 |
| [references/agentic_ai_practice_requirements.md](./references/agentic_ai_practice_requirements.md) | AWS Agentic AI 实践要求（六大核心能力） | AI Agentic 架构师 |
| [templates/design_doc_template.md](./templates/design_doc_template.md) | 通用设计模板（11 章） | LLM、文档生成 |
| [templates/design_doc_template_ai_agentic.md](./templates/design_doc_template_ai_agentic.md) | AI Agentic 专用模板（14 章） | LLM、AI 项目 |

---

## 版本信息

**当前版本**: v1.8 (2026-01-18)

### v1.8 (2026-01-18) - 结构优化版
✨ **核心改进**:
- ✅ 重新编排流程顺序（步骤 2 架构决策 → 步骤 3 架构图处理）
- ✅ 新增流程图可视化（ASCII 图）
- ✅ 新增决策点检查（步骤 1 → 2 之间）
- ✅ 精简模板选择说明（合并到步骤 4）
- ✅ 强化禁止事项（表格化 + emoji 标记）
- ✅ 移除冗余版本历史（保留最近 2 版）
- ✅ 减少 25% 冗余内容，提升逻辑严谨性

### v1.7 (2026-01-13)
✨ **优化版本发布**:
- 精简为 950 行（原 1534 行，减少 38%）
- 分离出 4 个专题文档
- 提升可读性和快速上手体验

**详细版本历史**: 参考 [DEEPV.md](./DEEPV.md) 的完整版本记录

---

## 快速开始

**第一次使用？** 推荐阅读顺序：
1. 阅读本文档 (SKILL.md) - 了解整体流程
2. 查看 [EXAMPLES.md](./EXAMPLES.md) - 学习实际案例
3. 参考 [BEST_PRACTICES.md](./BEST_PRACTICES.md) - 掌握最佳实践
4. 深入研究 [DEEPV.md](./DEEPV.md) - 理解内部设计

**需要帮助？** 查看 [相关文档](#相关文档) 部分，找到对应的专题指南。
