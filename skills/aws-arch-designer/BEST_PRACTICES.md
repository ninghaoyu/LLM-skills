# 最佳实践与检查清单

本文档汇总 AWS 架构设计说明书生成器的最佳实践、常见错误和验证清单。

---

## 目录

- [核心原则](#核心原则)
- [工作流检查清单](#工作流检查清单)
- [AI/ML 项目特别指南](#aiml-项目特别指南)
- [大数据项目特别指南](#大数据项目特别指南)
- [常见错误和避坑](#常见错误和避坑)
- [质量保证检查清单](#质量保证检查清单)

---

## 核心原则

### 1. 严格遵循 6 步流程

不可跳过或合并任何步骤：

```
步骤 0: 案例学习文件识别（可选但推荐）
    ↓
步骤 1: Material Parser（需求清洗和确认）
    ↓
步骤 2: Architecture Diagram Generation（架构图处理）
    ↓
步骤 3: Architecture Decisioning（架构决策）
    ↓
步骤 4: Design Writer（文档生成）
    ↓
步骤 5: Design Reviewer（质量审核）
```

**原因**: 每个步骤都有特定目的，跳过会导致设计不完整或决策不当。

---

### 2. 尊重用户的架构图（CRITICAL）

**如果用户提供了架构图**:
- ✅ 理解、验证、描述
- ❌ **不要自作主张设计替代方案**
- ❌ **不要调用 MCP Server 生成新的架构图**
- ❌ **不要在已有架构的基础上强行重新评估**

**如果用户未提供架构图**:
- ✅ 基于需求进行架构设计
- ✅ 调用 MCP Server 生成架构图
- ✅ 进行完整的 WAF 评估

---

### 3. WAF 检查是强制的

每个架构设计都必须通过 AWS Well-Architected Framework 的六大支柱检查：

1. **卓越运营** (Operational Excellence)
2. **安全性** (Security)
3. **可靠性** (Reliability)
4. **性能效率** (Performance Efficiency)
5. **成本优化** (Cost Optimization)
6. **可持续性** (Sustainability)

不可跳过或简化任何支柱。

---

### 4. 主动追问缺失信息

发现缺失的 **P0 关键信息**必须追问：

- **RTO/RPO** - 影响灾备设计
- **可用性要求** - 影响 Multi-AZ 决策
- **预估流量/QPS** - 影响扩展策略
- **AWS 区域** - 影响服务可用性

不可假设或跳过。

---

### 5. 记录所有决策理由

每个技术选择都要有明确的说明：

```markdown
## 选择理由 (Why)
为什么选择这个方案...

## 权衡说明 (Trade-off)
优势:
- ...
劣势:
- ...
替代方案:
- ...
```

---

## 工作流检查清单

### 步骤 1: Material Parser

- [ ] 所有输入材料都已理解（Word、PDF、图片、Excel、文本）
- [ ] 5 大关键要素都已提取：
  - [ ] 功能需求
  - [ ] 非功能需求
  - [ ] 合规性要求
  - [ ] 预算限制
  - [ ] 预估流量
- [ ] 项目类型已正确识别（Web/AI/BigData/Migration/SaaS）
- [ ] P0 缺失信息已标记并追问
- [ ] 用户提供的架构图已检测并记录

**常见遗漏**:
- ❌ 未识别用户提供的架构图
- ❌ 未追问 RTO/RPO
- ❌ 假设了流量估算而不是追问
- ❌ 忽略了合规性要求

---

### 步骤 2: Architecture Diagram Generation

- [ ] 判断逻辑正确：用户提供架构图 vs 未提供
- [ ] **如果用户提供了架构图**：
  - [ ] 理解了用户的架构设计
  - [ ] 生成了架构图的文字描述
  - [ ] 进行了一致性验证（仅验证，不修改）
  - [ ] 没有自作主张生成替代方案
- [ ] **如果用户未提供架构图**：
  - [ ] 基于需求进行了架构设计
  - [ ] 构建了结构化的架构蓝图
  - [ ] 调用 MCP Server 生成了架构图
  - [ ] 生成了架构图的文字描述

**常见错误**:
- ❌ 用户提供了架构图，还是自作主张生成了新的
- ❌ 没有调用 MCP Server 而是手动描述
- ❌ 架构图与最终设计不一致

---

### 步骤 3: Architecture Decisioning

- [ ] 选择了正确的架构模式
- [ ] 进行了完整的服务选型决策
- [ ] 每个决策都有 Why、Pros、Cons、Alternatives
- [ ] **执行了完整的 WAF 检查**（6 大支柱）
- [ ] AI/ML 项目进行了额外的 AI 特有检查
- [ ] 大数据项目进行了额外的大数据特有检查
- [ ] 进行了 Region 合规性检查

**检查清单**:
```
WAF 六大支柱:
- [ ] 卓越运营 - CloudWatch/Logs/Automation 已规划
- [ ] 安全性 - IAM/KMS/TLS 已规划
- [ ] 可靠性 - Multi-AZ/Backup/RTO-RPO 已规划
- [ ] 性能效率 - 实例类型/缓存 已规划
- [ ] 成本优化 - Auto Scaling/RI/Savings Plans 已规划
- [ ] 可持续性 - Graviton/Serverless 已考虑

AI/ML 项目额外检查:
- [ ] Token 成本控制
- [ ] 推理性能优化
- [ ] 幻觉检测和 HITL
- [ ] 模型选择有理由

大数据项目额外检查:
- [ ] 数据分区策略
- [ ] 存储成本优化
- [ ] 数据质量检查
- [ ] ETL 失败处理
```

---

### 步骤 4: Design Writer

- [ ] **选择了正确的模板**：
  - [ ] AI/ML-Agentic → `design_doc_template_ai_agentic.md`
  - [ ] 其他 → `design_doc_template.md`
- [ ] **填充了所有占位符**：
  - [ ] 没有残留 `{PLACEHOLDER}`
  - [ ] 所有 P0 占位符都已填充
  - [ ] 所有 P1 占位符都已填充
- [ ] **按正确的章节顺序**：
  - [ ] 通用模板：11 个章节
  - [ ] AI Agentic：14 个章节
- [ ] **包含了 Why 和 Trade-off**：
  - [ ] 每个技术选择都有理由
  - [ ] 每个决策都有权衡说明
- [ ] **假设明确标注**：
  - [ ] 使用 `【假设】` 标签
  - [ ] 待确认内容使用 `【待确认】` 标签

---

### 步骤 5: Design Reviewer

- [ ] **区域合规性检查**：
  - [ ] China Region 是否使用了不可用服务
  - [ ] 是否考虑了数据合规性
- [ ] **架构一致性检查**：
  - [ ] 没有矛盾设计
  - [ ] 没有过度设计
  - [ ] 服务选择与需求相符
- [ ] **必备组件检查**：
  - [ ] IAM 设计完整
  - [ ] CloudWatch Logs 方案清晰
  - [ ] Backup 策略明确
  - [ ] RTO/RPO 已定义
  - [ ] 成本估算已提供
  - [ ] 监控和告警已规划
- [ ] **Best Practice 检查**：
  - [ ] Multi-AZ 部署（生产环境）
  - [ ] 加密已启用（传输+静态）
  - [ ] MFA 已配置
  - [ ] 告警已设置

---

## AI/ML 项目特别指南

### AI/ML 项目特殊要求

#### 1. 模型选择（必须）

| 决策点 | 候选 | 评估维度 |
|-------|------|---------|
| **LLM 推理** | Bedrock vs SageMaker | 成本、功能、TTM |
| **模型** | Claude vs Llama vs Titan | 推理能力、成本、场景适配 |
| **Embedding** | Bedrock vs 第三方 | 成本、质量 |
| **向量数据库** | OpenSearch vs Kendra vs pgvector | 成本、性能、功能 |
| **部署方式** | Real-time vs Serverless vs Batch | 延迟、成本 |

#### 2. Token 成本控制（CRITICAL）

```markdown
【Token 成本控制】
- 月均调用量: X 次
- 平均输入 Token: Y
- 平均输出 Token: Z
- 单位价格: $price/1K
- 月估算成本: $cost

控制策略:
- Prompt 缓存减少重复 Token
- 限制上下文长度
- 工具响应摘要而非完整
- 模型选择（Haiku vs Sonnet 的成本差异）
```

**常见错误**:
- ❌ 没有分析 Token 成本
- ❌ 选择了过贵的模型
- ❌ 没有成本控制策略

#### 3. 幻觉检测和防护（CRITICAL）

```markdown
【幻觉检测】
- 检测方式: Guardrails/Fact Checking/HITL
- 高风险查询: 哪些场景最容易产生幻觉
- 降级策略: 低置信度时的处理
- 人类在循环: HITL 流程设计
- 监控指标: 幻觉率、人工审核占比
```

**常见错误**:
- ❌ 完全信任 LLM 输出
- ❌ 没有事实检验机制
- ❌ 没有人类在循环设计

#### 4. AI Agentic 项目额外要求

**仅限 Agentic 项目**:
- [ ] Agent Orchestrator 选择（Bedrock Agents vs LangChain）
- [ ] Action Groups 设计（每个工具的输入/输出）
- [ ] 工具错误处理机制
- [ ] 状态管理和会话生命周期
- [ ] **多 Agent 协调**（若有）
- [ ] Agent 成功率监控
- [ ] 推理延迟监控
- [ ] 人工接管流程设计

---

## 大数据项目特别指南

### 大数据项目特殊要求

#### 1. 数据分区策略（必须）

```markdown
【数据分区】
- 分区维度: 时间(日期)/地域/业务维度
- 分区粒度: year/month/day 或更细粒度
- 分区性能: 预期查询性能提升
- 生命周期: 多久的数据保留在 hot storage
```

#### 2. 存储成本优化（必须）

```markdown
【存储优化】
- S3 分类: Standard/IA/Glacier 分层
- 生命周期策略: 何时降级存储等级
- 数据压缩: Parquet/ORC 等列式存储
- 预期节省: X% 的存储成本
```

#### 3. 数据质量和治理（必须）

```markdown
【数据质量】
- 质量检查: Schema 验证、完整性检查
- 数据脱敏: 敏感数据如何处理
- 血缘追踪: 数据来源和转换流程
- 异常告警: 何时触发数据质量告警
```

---

## 常见错误和避坑

### ❌ 步骤 1 常见错误

| 错误 | 后果 | 如何避免 |
|-----|------|---------|
| 未追问 P0 信息 | 架构设计不当 | 使用 P0 清单逐一检查 |
| 假设用户需求 | 需求不符 | 所有不确定的信息都要追问 |
| 未识别架构图 | 遗漏用户决策 | 在步骤 2 中明确检查 |
| 忽略合规要求 | 审计失败 | 列出所有合规关键词 |

---

### ❌ 步骤 2 常见错误

| 错误 | 后果 | 如何避免 |
|-----|------|---------|
| 用户有图还自己生成 | 不尊重用户设计 | 严格遵循判断逻辑 |
| 没有生成架构图 | 文档不完整 | 无图时调用 MCP Server |
| 架构图与设计不符 | 文档不一致 | 在步骤 5 验证一致性 |
| MCP Server 调用失败 | 流程中断 | 需要降级方案 |

---

### ❌ 步骤 3 常见错误

| 错误 | 后果 | 如何避免 |
|-----|------|---------|
| 跳过 WAF 检查 | 设计不符合 Best Practice | 强制执行 WAF 检查 |
| 过度设计 | 成本升高 | 优先选择简单方案 |
| 忽略 AI 特有检查 | AI 项目成本爆炸 | AI 项目必须检查 Token/幻觉 |
| 不考虑 Region 限制 | 服务不可用 | China Region 有特殊限制 |

---

### ❌ 步骤 4 常见错误

| 错误 | 后果 | 如何避免 |
|-----|------|---------|
| 用错模板 | 章节不符 | AI Agentic 严格使用专用模板 |
| 占位符未填充 | 文档不完整 | 验证清单中逐一检查 |
| 缺少 Why 和 Trade-off | 设计理由不清 | 每个决策都必须有说明 |
| 假设未标注 | 审计问题 | 使用【假设】标签 |

---

## 质量保证检查清单

### 文档完整性检查

- [ ] 所有章节都已包含
  - [ ] 通用模板：11 章
  - [ ] AI Agentic：14 章 + 2 附录
- [ ] 所有占位符都已填充
  - [ ] 没有 `{PLACEHOLDER}` 残留
  - [ ] 没有空白章节
- [ ] 目录和内容一致
  - [ ] 章节号码正确
  - [ ] 链接可用

### 内容质量检查

- [ ] **每个技术选择都有**：
  - [ ] 为什么选择（Why）
  - [ ] 优势和劣势（Trade-off）
  - [ ] 替代方案和升级路径
- [ ] **假设都已标注**：
  - [ ] 使用 `【假设】` 标签
  - [ ] 使用 `【待确认】` 标签
- [ ] **设计符合 WAF 要求**：
  - [ ] 6 大支柱都有对应设计
  - [ ] AI/大数据项目有额外检查
- [ ] **没有矛盾设计**：
  - [ ] 架构与需求一致
  - [ ] 成本与功能平衡
  - [ ] 安全性充分考虑

### 格式规范检查

- [ ] **Markdown 格式正确**：
  - [ ] 标题级别正确（##、###）
  - [ ] 列表格式一致
  - [ ] 代码块有语言标记
  - [ ] 表格排版整齐
- [ ] **中文文本规范**：
  - [ ] 没有语病
  - [ ] 术语翻译一致
  - [ ] 标点符号正确
- [ ] **文件命名规范**：
  - [ ] 格式: `{PROJECT_NAME}_架构设计说明书_v1.0.md`
  - [ ] Agentic 项目：`{PROJECT_NAME}_Agentic_架构设计说明书_v1.0.md`

### 交付前最终检查

```markdown
【最终验证清单】

基础检查:
- [ ] 文件名符合规则
- [ ] 文件编码为 UTF-8
- [ ] 没有 Markdown 语法错误
- [ ] 可以正常打开和阅读

内容完整性:
- [ ] 所有 11/14 个章节都存在
- [ ] 没有遗漏章节
- [ ] 没有空白内容
- [ ] 所有占位符都已替换

设计质量:
- [ ] 没有 WAF 遗漏
- [ ] 没有过度设计
- [ ] AI 项目成本已控制
- [ ] 大数据项目分区已规划

交付物:
- [ ] 单个 Markdown 文件
- [ ] 完整可阅读
- [ ] 可直接交付客户
```

---

## 总结

**5 条铁律**:
1. ✅ **严格遵循 6 步流程** - 不可跳过或合并
2. ✅ **尊重用户的架构图** - 不自作主张
3. ✅ **WAF 检查强制执行** - 每个支柱都要评估
4. ✅ **记录所有决策理由** - Why + Trade-off
5. ✅ **主动追问缺失信息** - P0 信息不可假设

**关键质量指标**:
- ✅ 0 个 `{PLACEHOLDER}` 残留
- ✅ 100% WAF 覆盖
- ✅ 100% 决策有理由
- ✅ 0 个架构矛盾
- ✅ 0 个过度设计

---

更多细节请参考：
- [SKILL.md](./SKILL.md) - 完整使用指南
- [DESIGN_WRITER_GUIDE.md](./DESIGN_WRITER_GUIDE.md) - 步骤 4 详细指南
- [EXAMPLES.md](./EXAMPLES.md) - 具体使用示例
